# this is a new file recording shell scripting tips
#windows, linux shell, mind file_path containing whitespace,注意路径名中带空格的,要用双引号引起来

####################
	Linux commands comes first
####################
1.netstat -n 1 |grep 192.168.204.128(find the number of sockets)
ip -6 addr
ping6 -c 4 -n www.google.com
2. time writes its output to stderr, time is part of the syntax of bash, and it times an entire pipeline. Consequetnly, I need to wrap the pipeline in braces, or run it in a subshell:
	{ time ls -l > /dev/null; } |& grep real(tested in ubuntu)
	(\& is an abbreviation for '2>&1 |')
	{ time ls -all; } 2> timeLog.txt
	(time ls) > ls_results 2> timeLog
	(time ls) > outfile 2>&1

	--2.1 Redirects stderr to the same stream as stdout, then redirects stdout to /dev/null, then pipes the output of time into the stdin of grep:
		(time ls -l)  2>&1 > /dev/null |grep real | awk '{print $2}'

	I can also use the time utility to control the format of output.(man time)
	/usr/bin/time -f%e ls -l > /dev/null

3. which mysql, /usr/local/mysql/bin/mysql
4. grep -P "[\x80-\xff]" fileWithChinesesChar.cpp
	grep recursive:	grep -r '<event' quest/ 
	(find the Chinese characters in a file)

5. get rid of xml comments in an xml file(removing single and multiple line comments)	
	(http://stackoverflow.com/questions/19230407/remove-xml-comments-using-regex-in-bash)
	
6. file -bi filename
	text/x-c; charset=iso-8859-1	
7. iconv -f ascii -t utf8 filename > newfilename
	iconv -c -f utf-8 -t ascii filename	
    
   What is the difference between utf-8 and iso-8859-1?
   UTF-8是能表示任意unicode字符的多字节编码;iso-8859-1是能代表前256个Unicode字符的单字节编码.对于ascii字符,两者是以相同方式编码的.

8. su - userName@
	make the shell as a login shell	
9. how to list source files(extensions .h .cpp .hpp)
	ls *h *cpp *hpp
	
10. using grep specific directories instead of findexp(grep is the fatest!)
	2 > /dev/null 是亮点,把烦人的找不到文件的错误隐藏起来,显示最终结果
	
	before:
	find . -iname \.*h -exec grep -nH keyword {} \;
	find . -iname \.*cpp -exec grep -nH keyword {} \;
	find . -iname \.*cpp -exec ls -alh $1 {} \;
	How to use find to FIND all the .cpp and .h files?
	find . \( -name \*.h -o -name \*.cpp \) -exec grep -nH keyword \{\} \;
	
	after:
	
	#!/bin/bash
	DIRS='
	dir_a
	dir_b
	dir_c
	'
	
	function grepDirs()
	{
		for eachDir in $DIRS
		do
			grep -nH $1 $eachDir/*h 2> /dev/null
			grep -nH $1 $eachDir/*cpp 2> /dev/null
		done
	}
	grepDirs $1
	
	grep do not grep specific directories
	grep pattern -r --include=\*.{cpp,h} rootdir
	grep pattern -r --include="*.{cpp,h}" --exclude="*\.svn" --exclude-dir="*\.svn" rootdir
    
    How to grep/sed newline character??(Use tr instead, tr '\n' ' ' < input_filename, tr -d '\n' <input.txt > output.txt
    How to use tr to replace newline with string? 1. use tr to replace newline with a character that don't appear in the text
    2. Use sed to replace that character with string.)
    grep and sed are matched against individual lines so there is no way for a pattern to match a newline.
    pcregrep -M "pattern1.*\n.*pattern2" filename
    using gnu sed (http://stackoverflow.com/questions/1251999/how-can-i-replace-a-newline-n-using-sed)
    sed ':a;N;$!ba;s/\n/ /g'
    BSD:
    sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/ /g'
    1. Create a label via ':a'
    2. Append the current and next line to the pattern space via N
    3. If we are before the last line, branch to the created label $!ba($! means not to do it on the last line as there should be one final newline).
    4. Finally the substitution replaces every newline with a space on the pattern space (which is the whole file).
	
	python subprocess grep color
	command = 'grep --color=always aaa file1.txt file2.txt' 
	proc = subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
	ok, err=proc.communicate()
	print(ok)

	grep each line of a file in another file?
	grep -Fwf file2 file1 > out(-F means plain string matching, faster without having to engage the regex engine)
	
	grep exclude binary files
	grep -I keyword -rnH directory/
	
	Why doesn't grep ignore binary files by default ?(http://unix.stackexchange.com/questions/70438/why-doesnt-grep-ignore-binary-files-by-default)
	Not everything that grep thinks is a binary file, is actually a binary file. e.g. puppet's logs have ansi color coding in them, which makes grep think they're binary. I'd still want to search them if I'm grepping through /var/log though
	
	find exclude path
	find . -type f -name "*_peaks.bed" ! -path "./tmp/*" ! -path "./scripts/*"
	! -path "./tmp/*" - Exclude all results whose path starts with ./tmp/ 9
    
    find directories having size greater than xMB?
    du -sm * | awk '$1 > 1'
    find file greater than x bytes?
    find ./ -maxdepth=1 -type f -size +4096c -exec ls -sh {} \;
    smaller than x Bytes?
    find ./ -maxdepth=1 -type f -size -4096c
    
    copy a directory exclude .svn files
    use svn export
    rsync -r --exclude=.svn /home/user/progname/ /home/user/progname.copy
    xcopy "..\source\" "..\destination\" /E /Y /R /exclude:exclude.txt
    exclude.txt should contain:

    .svn\

11. run script in current shell without dot before command( ./script_name.sh)
	alias script_name.sh='. ./script_name.sh'
	
12. check linux distribution
	cat /proc/version	
	
13. xshell里越南文显示为问号，中文的·显示不正常（数字键1左边的键）
	xshell连接里，translation, encoding,选UTF-8
	.bash_profile , export LANG=zh_CN.utf-8, export LC_ALL=zh_CN.utf-8
	日文，中文，越南文都能显示出来
	
	xshell 连接 ubuntu里中文显示为乱码
	vim ~/.bashrc中LANG=zh_CN.gb2312
	source ~/.bashrc
	xshell的终端 连接里面改为 "默认语言"
	
14.shell get nth line of stdout
	ls -l |sed -n 2p
	ls -l | awk 'NR==2'
	ls -l |sed -n 2,4p
	ls -l | sed -n -e 2,4p -e 20,30p
	ls -l | sed -n -e '2,4p;20,30p'		

15. How to sed specific line?
	sed -r '30s/origin_content/new_content/g' filename > temp	
	
	using sed to delete the whole line in a text file that contains a specific string
	sed -i '/pattern to match/d' ./infile
	
	using sed to delete empty line
	sed -i '/^\s*$/d' filename
	
	sed groups
	sed "s/\(taskbase.[a-zA-Z]*\)/c_sysDebug('\1' .. \1)"
	cat aaa.txt | sed "s/aaa/ab = '\\\n' .. cd/"
	
	在每行开头和结尾加引号
	add quote at the beginning and the end of one line
	:%s#^\(.*\)#'\1'#
	
	replace tabs to spaces(two spaces) in all files
	1.  get all files needed :
	    find . ! -path "*svn-base*" ! -path "*\.svn*" -type f 
	2.1 sed -i 's/\t/  /g'  (DO NOT USE SED! If there's an embedded tab in a string, you may end up mangling your code. This is what expand command was meant to handle. Use expand)
	                         If there are "extra" spaces between the tabs they will still be there after substitution, so the margins will be ragged. Tabs expanded in the middle of lines will also not work correctly
	2.2 find . -name '*.cpp' ! -type d -exec bash -c 'expand -t 2 "$0" > /tmp/e && mv /tmp/e "$0"' {} \;
	    (The expand utility shall write files or the standard input to the standard output with <tab>s replaced with one or more <space>s needed to pad to the next tab stop. 
		Any <backspace>s shall be copied to the output and cause the column position count for tab stop calculations to be decremented; 
		the column position count shall not be decremented below zero.)
	    Remember to backup before doing domething like this.
	

16. the awk command
	awk 'NR==34 { sub("AAA", "BBB") }'
	awk 'FNR==34 { sub("AAA", "BBB") }'	
	awk 求和
	awk 'BEGIN{total=0}{total+=$1}END{print total}'
	awk the last line
	awk -F';' '{print $NF}'
	
	awk concatenate
	awk '{b=$1"<=>"$2; print b}' file
	
	awk format string (https://www.gnu.org/software/gawk/manual/html_node/Format-Modifiers.html#Format-Modifiers)
	awk BEGIN meaning
	num=1
	echo $num | awk '{printf("%02d", $0)}'
	01
	echo $num | awk 'BEGIN{printf("%02d", $0)}'
	00
    
    awk print to the end of the line(column to the end)
    awk -F':' '{for(i=4;i<=NF;++i){print("%s,$i")}; printf("\n")}'
	
	awk BEGIN meaning:(https://www.gnu.org/software/gawk/manual/html_node/Using-BEGIN_002fEND.html)
	(https://www.gnu.org/software/gawk/manual/html_node/index.html#SEC_Contents)
	A BEGIN rule is executed once only, before the first input record is read. Likewise, an END rule is executed once only, after all the input is read.
	awk 'BEGIN {printf("%s %8s %8s %8s \n" ,"field1", "field2", "field3", "field4")}
	{printf("%6.2f %8.2f %8.2f %8.2f\n", $1, $2, $3, $4)}' input
	
	field1   field2   field3   field4 
	11.79     7.87    11.79    68.00
	11.79     7.87    11.79    68.00
	11.79     7.87    11.79    68.00
	11.79     7.87    11.79    68.00

	Read records from a file and grep in another file?
	assume name.txt:
	John
	Mike
	Smith
	---
	data.txt:
	Go to work, Lee, 2017-02-26
	Go to work, John, 2017-02-26
	Go to work, Smith, 2017-02-26

	1. Write a shell script:
	while read name; do
		grep $name data.txt
	done < name.txt > all_grep_results
	2. Using grep
	grep -Fwf name.txt data.txt > all_grep_results
	3. Using awk
	awk -v FS="[ ,]" 'NR==FNR{rows[$1]++;next} ($5 in rows)' name.txt data.txt
	(去掉($5 in rows)的括号也可以.为什么不用{$5 in rows}? 因为大括号是 action,awk不会打印出该行;不加括号awk默认为 condition,判断为true后,会打印出该行
	原因参见 http://backreference.org/2010/02/10/idiomatic-awk/	
	)
	#awk -v FS="[ =]" 'NR==FNR{rows[$1]++;next}(substr($NF,1,length($NF)-1) in rows)' File1 File2
	#awk -v FS="[ =]" 'NR==FNR{rows[$1]++;next} {for (k in rows){print k": "rows[k]}}' File1 File2
	#awk '{my_dict[$1] = $2} END { for (key in my_dict) { print key ": " my_dict[key] } }' zen
	
17. tar commands
	tar -zcvf archive.tar.gz directory/ 
This will tell tar to c (create) an archive from the files in directory (tar is recursive by default), compress it using the z (gzip) algorithm, store the output as a f (file) named archive.tar.gz, and v (verbosely) list all the files it adds to the archive.
	tar -zxvf archive.tar.gz 
	tar -jxvf archive.tar.gz 
	
	tar uncompress xz file
	tar xf archive.tar.xz
    
    tar ignore directory, excluding certain directories/files
    tar all_source.tar.bz2 source_code/ --exclude='file1' --exclude='patter*' --exclude='file2'

18.	iptables
	iptables -I INPUT -s 180.168.197.99 -p tcp -m state --state NEW -m tcp --dport 9823 -j ACCEPT	
	-j specifies what needs to happen to the packet that matches this firewall rule.
	-s indicates the source of the packet. This can be ip address, or network address, or hostname
	-p is for protocol
	
	delete iptables rules(an iptables rules)
	iptables -D INPUT 4
	iptables -D INPUT -s 127.0.0.1 -p tcp --dport 111 -j ACCEPT
	
	iptables -F(close all firewalls)
	
	iptables -I INPUT -p tcp --dport 2124 --syn -j ACCEPT
	service iptables save
	semanage port -a -t ssh_port_t -p tcp 2124
	
	On a high-level iptables might contain multiple tables. Tables might contain multiple chains. Chains can be built-in or user-defined. Chains might contain multiple rules. Rules are defined for the packets.
	1. Filter Table(mangle table, nat table, raw table)
	Filter is default table for iptables. So, if you don’t define you own table, you’ll be using filter table. Iptables’s filter table has the following built-in chains.

	INPUT chain – Incoming to firewall. For packets coming to the local server.
	OUTPUT chain – Outgoing from firewall. For packets generated locally and going out of the local server.
	FORWARD chain – Packet for another NIC on the local server. For packets routed through the local server.
	
	Following are the key points to remember for the iptables rules :
	Rules contain a criteria 标准条件 and a target.
	If the criteria is matched, it goes to the rules specified in the target (or) executes the special values mentioned in the target.
	If the criteria is not matached, it moves on to the next rule.
	
	Target Values
	Following are the possible special values that you can specify in the target.
	ACCEPT – Firewall will accept the packet.
	DROP – Firewall will drop the packet.
	QUEUE – Firewall will pass the packet to the userspace.
	RETURN – Firewall will stop executing the next set of rules in the current chain for this packet. The control will be returned to the calling chain.
	
	If you don’t specify the -t option, it will display the default filter table. So, both of the following commands are the same.
	iptables -L
	num – Rule number within the particular chain
	target – Special target variable that we discussed above
	prot – Protocols. tcp, udp, icmp, etc.,
	opt – Special options for that specific rule.
	source – Source ip-address of the packet
	destination – Destination ip-address for the packet
    
    How to delete iptables rules?
    sudo vim /etc/sysconfig/iptables , delete the old rules
    sudo vim /etc/sysconfig/iptables.save, delete the old rules
	or : iptables -L --line-number
	iptables -D INPUT 2

	How to open TCP port 2015 on RHEL6?
	iptables -I INPUT -p tcp --dport 2015 -j ACCEPT(insert)
	iptables -L -n
	iptables -A INPUT -p udp -m udp --dport 10000:20000 -j ACCEPT(append)

	What is sport and dport?
	--sport --source-port
	--dport --destination-port
	iptables -A OUTPUT -p tcp --dport 80 -j DROP

	
19.	du -sh flodername show the entire size of the folder,查看整个文件夹大小
20.	问题：在Xshell中设置了“自动将选中的文字复制到粘贴板”，之前一直没有问题，最近发现，
只要选中屏幕上的文字，复制上了，但shell终端立即被中断了，即向终端发送了CTRL-C；
原因：
很可能是“选中文字复制”与词典软件的“划词翻译”相冲突。
我的原因是，最近安装了必应词典，且开启了“划词翻译”功能。 
我在网上求助时，发现也有一些朋友遇到和我一样的问题，都是由于与词典的冲突导致的，如有道词典，关掉划译功能即可。

21.	Find out if running Linux kernel (OS) is 32 or 64 bit?
uname -a 
 getconf LONG_BIT
 grep flags /proc/cpuinfo
 grep -o -w 'lm' /proc/cpuinfo(lm flag means Long mode cpu - 64 bit CPU )

Find out the current operating system:
uname -a
lsb_release -a
cat /etc/lsb-release
cat /etc/issue.net
cat /etc/debian_version
cat /etc/redhat-release

22.	  #!/bin/bash          
            STR="Hello World!"
            echo $STR    
			
23.	error while loading shared libraries : lib*** cannot open shared object file : No such file or directory
	export LD_LIBRARY_PATH = path_of_lib:$LD_LIBRARY_PATH	
	为什么是LD_LIBRARY_PATH,而不是PATH呢???
	
24.	search under ubuntu
	apt-cache search gtk

25.	How to install VSCode under ubuntu?
	unzip VSCode.zip -d ~/develop/
	cd ~/develop/
	./Code
	sudo ln -s ~/develop/VSCode/Code /usr/local/bin/code
	(libgtk-x11-2.0.so.0: cannot open shared object file: No such file or directory)
	
26.	How to get last day of month in linux??
	tempmonth=5
	lastDay=`date -d "2015-${tempmonth}-01 -1 day" +%Y-%m-%d | awk -F'-' '{print $3}'`
	
27.	How to tar files??
	tar -jcvf $obj_log_name $(ls /backup/log/222.255.177.*/objscene*.log.15${month}${tempDay}-*)
	
28.	install .deb file on ubuntu
	dpkg -i PACKAGE.deb
    
    install pthread man pages on ubuntu(man pthreads)
    sudo apt-get install manpages-posix manpages-posix-dev
    
    apt-key del, How to remove key added?
    sudo apt-key list
    pub   1024R/B455BEF0 2010-07-29
    uid                  Launchpad clicompanion-nightlies
    nits@nits-excalibur:~$ sudo apt-key del B455BEF0
    nits@nits-excalibur:~$ apt-key list | grep clicompan
    nits@nits-excalibur:~$ 
    
    apt-get install python-pip
    Reading package lists... Done
    Building dependency tree       
    Reading state information... Done
    You might want to run 'apt-get -f install' to correct these:
    The following packages have unmet dependencies:
    bittorrent : Depends: python-wxgtk2.6 but it is not installable
                Depends: python-twisted (>= 2.0) but it is not going to be installed
                Depends: python-crypto (>= 2.0) but it is not going to be installed
                Depends: python-psyco but it is not installable
                Depends: python-zopeinterface
    python-pip : Depends: python-colorama but it is not going to be installed
                Depends: python-distlib but it is not going to be installed
                Depends: python-html5lib but it is not going to be installed
                Depends: python-pkg-resources but it is not going to be installed
                Depends: python-requests but it is not going to be installed
                Depends: python-setuptools (>= 0.6c1) but it is not going to be installed
                Depends: python-six but it is not going to be installed
    E: Unmet dependencies. Try 'apt-get -f install' with no packages (or specify a solution)
    How to solve the problem?
    sudo apt-get -f install
    dpkg --configure -a
    sudo apt-get -f install
    sudo apt-get install python-pip
    
    sudo apt-get -f install fails
    trying to overwrite '/usr/include/bits', which is also in package libc6-dev-amd64:i386 2.23-0ubuntu4
    dpkg --purge --force-depends "gcc-multilib"
    dpkg --purge --force-depends "gcc-5-multilib"
    dpkg --purge --force-depends "g++-5-multilib"
    dpkg --purge --force-depends "g++-multilib"
    dpkg --purge --force-depends "libc6-dev-x32"
        
    cannot find device br0 failed to bring up br0
    sudo apt-get install bridge-utils
    
    How to change timezone in Ubuntu(to UTC)?
    sudo dpkg-reconfigure tzdata
    select None of the above, choose UTC.
    
    (由于地球公转一周为365日5时48分46秒（或365.25日），与一年相差5时48分46秒。这样每过四年就会多一天。
    因而被四整除的非世纪年是闰年，但这样每过四百年又多出一天。所以后来规定世纪年只有能被四百整除的才是闰年)
    How to get seconds in one year by year?
    unsigned int getDaysInYear(unsigned int year)
    {
        if ((year % 4 == 0 && year % 100 != 0 ) || year % 400 == 0)//leap year
        {
            return 366;
        }
        return 365;
    }
	
29.	awk with grep
	awk '{print $1}' input.txt | xargs -n 1 -I pattern grep -wnH pattern ScenesServer/
	
	awk with for loop
	awk '{for (i=1; i <= NF; i++) total=total + $i}; END {print total}'
	
30.	timestamp to date
	date -d @1267619929 +%Y-%m-%d
	
31. Get the dates between two dates(get days between two dates)
	date1=2015-07-21
	date2=2015-07-28
	timestamp1=`date -d "$date1" +%s`
	timestamp2=`date -d "$date2" +%s`
	for ((start = $timestamp1; start <= $timestamp2; start = start + 86400))
	do
		thisDate=`date -d @$start +%Y-%m-%d`
		echo $thisDate
	done
	
32.	Get monday of current week(get monday of a specific time)
	nowTime=2015-07-24
	weekDay=`date -d "$nowTime" +%u`
	monday=`date -d "$nowTime $weekDay days ago" +%Y-%m-%d`
	echo $monday
	
	(GNU date)
	(http://www.gnu.org/software/coreutils/manual/html_node/Date-input-formats.html#Date-input-formats)
	date -dmonday +%Y-%m-%d
	
33.	Get week of the year
	date +%V(show the week of the year)
	date -d "20150723" +%V
	
34.	When does daily cron.daily run??
	cat /etc/crontab
	
35.	add crontab event(daily, weekly)
	* * * * * command to be executed
	- - - - -
	| | | | |
	| | | | ----- Day of week (0 - 7) (Sunday=0 or 7)
	| | | ------- Month (1 - 12)
	| | --------- Day of month (1 - 31)
	| ----------- Hour (0 - 23)
	------------- Minute (0 - 59)
	0 0 * * * /home/userName/run.sh
	
36. Uninstall a sudo apt-get install(http://askubuntu.com/questions/187888/what-is-the-correct-way-to-completely-remove-an-application)
	sudo apt-get remove npm
	
	Ubuntu show install packages?
	dpkg --get-selections | grep -v deinstall
	dpkg -l
	apt --installed list
	
37. awk conflict with shell arguments
	using single quotes, not double quotes.
	Shell will expand the value of $1 in double quotes using shell argument.

38. how to use ssh to run shell script on a remote machine(ssh execute remote command)
	(http://stackoverflow.com/questions/305035/how-to-use-ssh-to-run-shell-script-on-a-remote-machine)
	ssh root@MachineB 'bash -s' < local_script.sh
	
39. How to make ssh quiet ?
	ssh -f root@192.1.1.1 "echo background"
	
40. putty login without password
	(https://www.digitalocean.com/community/tutorials/how-to-create-ssh-keys-with-putty-to-connect-to-a-vps)
	(https://www.digitalocean.com/community/tutorials/how-to-use-ssh-keys-with-putty-on-digitalocean-droplets-windows-users)
	1. puttygen generate a public key,  Save private key, without a passphrase.
	(Click on both the Save public key button and the Save private key button and select a secure location to keep them:)
	2. Right click Key panel, copy all
	3. vi ~/.ssh/authorized_keys, paste
	4. check the file mode chmod 600 ~/.ssh/authorized_keys
	
	putty errors:
	unable to use key file (not a private key)
	(save as private key, not Public key)
	
41. Bitbucket add ssh keys(https://confluence.atlassian.com/bitbucket/set-up-ssh-for-git-728138079.html)
    1. From Bitbucket Cloud, choose avatar > Manage account from the application menu. 
	2.Click SSH keys.
	3.Back in your terminal window, copy the contents of your public key file.
	4.Click Clone button, change clone method from https --> ssh.
	5. git clone git@bitbucket.org<accountname>/<reponame>.git
	
42. git repository change
    git clone --bare git://github.com/username/project.git
	git push --mirror git@gitcafe.com/username/newproject.git
	
43. grep two or more patterns
    grep -E 'foo|bar' *.txt
	
44. How to convert multiline data to one line ?
	(http://stackoverflow.com/questions/2764051/how-to-join-multiple-lines-of-file-names-into-one-with-custom-delimiter)
	ls -1 | tr '\n' ','
	paste -d, -s file
	cat file | xargs
    
45. How to check the timestamp of a file?
    stat --printf '%n\nmtime: %y\nctime: %z\natime: %x\ncrtime:%w\n'
    stat -c "%n %Z" file1.txt
    Each file has three distinct associated timestamps: the time of last data access, the time of last data modification, and the time the file status last changed. These values are returned in the file characteristics structure struct stat, as described in <sys/stat.h>.
	linux ls time seconds
    ls --full-time
    
46. rhel6 redhat 6 manually change time zone
    ll /etc/localtime
    ln -sf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
    
47. How to measure the average CPU utilization of a Linux process? 平均CPU使用率
    sudo apt-get(yum) install sysstat
    pidstat 3 -t pid
	
48. Linux use screen to keep process running background:
    Method 1. nohup ./executable
    Method 2. 
        user@machineName:~$ screen,Press space
        user@machineName:~$ ./executable
        Ctrl a c - Creates a new screen session so that you can use more than one screen session at once.
        Ctrl a n - Switches to the next screen session (if you use more than one).
        Ctrl a p - Switches to the previous screen session (if you use more than one).
        Ctrl a d - Detaches a screen session (without killing the processes in it - they continue).
        Press "Ctrl a d" to detach from the screen while the processes is still running.
        user@machineName:~$ screen -ls	 
        user@machineName:~$ screen -r 2477.pts-0.server1
        user@machineName:~$ exit(leave and finish a screen session)
        
    What does screen do?
                                Terminal  (/dev/ttyX or /dev/pts/x)
                                device
                                   |
                    (screen)<--[<output]----x-------(stdout) Process1
        Terminal  (keyboard)---[input >]---o-\----->(stdin)
                                            \ \
(hardware console or                         \ `----(stdout) Process2
 virtual console or terminal                  `---->(stdin)
 emulators like xterm, …)
 
 
             Terminal                   pseudo
             devices              ,--> Terminal (/dev/pts/x)
                |         _______/      device
Terminal <--[<output]--- |       |        |
 1       ---[input >]--> |screen | <--[<output]---x-----(stdout) Process1
                         |Process| ---[input >]--o-\--->(stdin)
Terminal <--[<output]--- |       |                \ \
 2       ---[input >]--> |_______|                 \ `--(stdout) Process2
                                                    `-->(stdin)
            
Line 2 creates a variable called STR and assigns the string "Hello World!" to it. 
Then the VALUE of this variable is retrieved by putting the '$' in at the beginning. 
Please notice (try it!) that if you don't use the '$' sign, the output of the program will be different, and probably not what you want it to be. 


1. special shell variables(http://unixhelp.ed.ac.uk/scrpt/scrpt2.2.2.html)

	$# the number of positional arguments given to this invocation of the shell.
	$? the exit status(exit code) of the last command executed(given as a decimal string)
	$$ the process number of this shell
	$! the process id of the last command run in the background
	$- the current options supllied to this invocation of the shell
	$* a string containing all the arguments to the shell, starting at $1
	$@ same as above
	"$*" is a single word, comprising all the arguments to the shell, joined together with spaces. '1 2' 3 becomes "1 2 3"
	"$@" is identical to the arguments received by the shell, the resulting list of words completely match what was given to the shell.'1 2' 3 becomes "1 2" "3"

2. shell scripts string manipulating(http://tldp.org/LDP/abs/html/string-manipulation.html)
	-----------
	string length:
		${#stringVariable}
		expr length $stringVariable
		expr "$stringVariable" : '.*'

	-----------
	substr index
		expr index $string $substr

	-----------
	substr removal
		${string#substring},deletes shortest match of $substring from front of $string
		${string##substring}, deletes longest match

	-----------
	string replacement
		${string/substring/replacement},replace first match of $substring with $replacement
		${string//substring/replacement}, replace all matches
		
	-----------
	compare two string variables
	For string comparison, use:

if [ "$s1" == "$s2" ]
For the a contains b, use:

if [[ $s1 == *"$s2"* ]]
if [[ $s1 == *${s2}* ]]

bash how to and expressions?
if [ ! -z "$var" ] && [ 1 -lt 2 ]; then
      # something ...
fi

3. search keywords : 'for line in grep'
	--how to process each line received as a result of grep command??
	grep xyz abc.txt | while read -r line ; do
		echo $line
		# do something here
	done
	
	If I need to change variables inside the loop, and have that change be visible outside of it
	while read -r line ; do
		echo $line
		# change the variable
	done < <(grep xyz abc.txt)
	
4. [: =: unary operator function expected
	[ unary operator function expected
	if [ "arg1" = "and" ];
	if $arg1 is undefined, then , is not valid.
	Use modern [[
	
5. How to use shell variables in sed??
	1.double quotes, sed 's/xxx/'"example$shell_variable"'/'	
	2. check if $shell_variable contains a slash, then do not use slash as delimeter of sed.
	检查shell变量里面，是否有斜线，如果有的话，要换分隔符
	
6.	concatenating shell variable and string literal without space
	shellVar='/home'
	"${shellVar}/anotherString"
	${shellVar}"/anotherString"	


7. if usage (You can see all the option meaning at : man bash, conditional expressions)
	if [ ! Expr ]; then
	fi	
	
	# -z string
    # True if the length of string is zero.
	if [ ! -z $2 ]; then
	fi
	

8. How to scp without password??
	Let me say that you want to copy file from source_host to dest_host
	1.on source_host, ssh-keygen -t rsa(just keep pressing Enter)
	2.copy ~/.ssh/id_rsa.pub to dest_host
	3.log onto dest_host
	4.cat id_rsa.pub >> ~/.ssh/authorized_keys
	chmod 700 ~/.ssh/authorized_keys
	
9.	Where is svn username and password located
	~/.subversion/auth/svn.simple/
10.	scp no password for two or more hosts
11.	 前景            背景             颜色
  ---------------------------------------
  30                40               黑色
  31                41               紅色
  32                42               綠色
  33                43               黃色
  34                44               藍色
  35                45               紫紅色
  36                46               青藍色
  37                47               白色
           1         透明色
 
  代码             意义
  -------------------------
  0                 OFF
  1                 高亮显示
  4                 underline
  5                 闪烁
  7                 反白显示
  8                 不可见
颜色=\033[代码;前景;背景m
PS1='\[\033[1;31;40m\]\u@\h:\w\$ '  
12.	set all the files directory 777(Buy why all file executable??)
	chmod 777 -r /tmp/dirName
	to change all the directories 755, find /tmp/dirName -type d -exec chmod 755 {} \;({} is replaced by file path. )
	to change all the diles to 644, find /tmp/dirName -type f -exec chmod 644 {} \;
	(semicolon denotes the end of the command,escaped,otherwise it will be interpreted by the shell)
	
13.	bash ls only directory	under "/home/userName/dir1"
	ls -d /home/userName/dir1/*/
	
14.	How to echo with color?(http://stackoverflow.com/questions/5947742/how-to-change-the-output-color-of-echo-in-linux)
	red='\033[0;31m'
	NC='\033[0m' # No Color
	echo -e "${red}Hello Stackoverflow${NC}"
    
    How to use echo to dynamically change content without newline?(echo -ne "\r")
    #!/bin/bash         
    while [ 1 ]    
    do    
        a=$(date)    
        echo -ne "$a\r"
    done 

	cecho() {
  local code="\033["
  case "$1" in
    black  | bk) color="${code}0;30m";;
    red    |  r) color="${code}1;31m";;
    green  |  g) color="${code}1;32m";;
    yellow |  y) color="${code}1;33m";;
    blue   |  b) color="${code}1;34m";;
    purple |  p) color="${code}1;35m";;
    cyan   |  c) color="${code}1;36m";;
    gray   | gr) color="${code}0;37m";;
    *) local text="$1"
  esac
  [ -z "$text" ] && local text="$color$2${code}0m"
  echo "$text"
}

cecho "Normal"
cecho y "Yellow!"	
	
	Black        0;30     Dark Gray     1;30
	Blue         0;34     Light Blue    1;34
	Green        0;32     Light Green   1;32
	Cyan         0;36     Light Cyan    1;36
	Red          0;31     Light Red     1;31
	Purple       0;35     Light Purple  1;35
	Brown/Orange 0;33     Yellow        1;33
	Light Gray   0;37     White         1;37
	
15.	piping through less, losing color
	alias ls='ls --color=auto', tells ls to only use colors when its output is a tty.
	ls --color=always | less -R

16.	bash print stderr in red color
	the_name_of_the_command 2> >(while read line; do echo -e "\e[01;31m$line\e[0m" >&2; done)	
	
	red_stderr.sh
	#set output file
	temp_file=~/temp
	#exeute the command
	"$@" 2> >(while read line; do echo -e "\e[01;31m$line\e[0m" | tee --append $temp_file ; done)	
	#display all errors
	echo -e "\n\e[01;31m===errors===\e[0m"
	cat $temp_file

	bash escape exclamation mark
	echo "#"'!'"/usr/bin/python" >> haha
	echo '#!/usr/bin/python' >> haha
	
17.	add and delete user
	useradd giant
	passwd  giant
	su - giant
	userdel -r giant
	
	add user on ubuntu 15.04, Ubuntu 14.04.2 LTS
	adduser git
	deluser git
    
    remove user from group ubuntu:
    deluser giant docker(remove giant from group docker)
	
    
    change a user's password in Linux from the command line with no interactivity:
    echo username:password | /usr/sbin/chpasswd
    (in BSD:echo "newpassword" | pw usermod theusername -h 0)
    
    change user name in linux:
    login as root(or login with other user, enter "sudo su"):
    usermod -l newUserName oldUserName
    usermod -d /home/newHomeDir -m newUsername
	
	change user and group id(uid) on Linux:
	1. assign a new UID to user using the usermod command.
	2. assign a new GID to group using the groupmod command.
	3. use the chown and chgrp commands to change old UID and GID respectively. You can automate this with the help of find command.
	change userid from 1000 to 2005
	usermod -u 2005 old_username
	groupmod -g 2005 old_groupname
	find / -group 1000 -exec chgrp -h foo {} \;
	find / -user 1000 -exec chown -h foo {} \;
    
    example:
    sudo -i
    killall -u belaje
    id belaje
    uid=1000(belaje) gid=1000(belaje) groups=1000(belaje),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),109(lpadmin),127(sambashare)
    usermod -l  balaja belaje
    groupmod -n balaja belaje
    usermod -d /home/balaja -m  balaja
    usermod -c "Bala Jagannathan" balaja
    id balaja
    
    change group name in Linux:
    groupmod -n <newgroup> <oldgroup>
	
	
18.	Enter passphrase for key '/root/userName/id_dsa.pub':
	This is because your private key is encrypted...remove the passphrase:
	ssh-keygen -p -f /root/.ssh/id_dsa -N ''
	
	or use private key to authenticate:
	ssh -v -i /root/.ssh/id_dsa backup@webserver.com
	ssh-copy-id -i /root/.ssh/id_rsa.pub backup@webserver.com
	
19.	Add private key permanently with ssh-add on Ubuntu
	Force the key files to be kept permanently, vim ~/.ssh/config
	IdentityFile ~/.ssh/gitHubKey
	IdentityFile ~/.ssh/id_rsa_buhlServer 
	
	If you want all users to use the key, vi /etc/ssh/ssh_config, make the folder accessible to all
	Specific to one host:
	vi ~/.ssh/config
	Host github
    HostName github.com
    User git
    IdentityFile ~/.ssh/githubKey
	
20.	Could not open termnal on ubuntu 15.04
	export LANG="en_US.UTF-8"
	Problem was a custom locale. Now using standard en_US.utf8 and gnome-terminal works normally.
	
21.	kill all apache2
	kill -hup pid(reload data)
	killall -9 httpd
	/usr/sbin/httpd -k start
	tailf /var/www/httpd/error_log
	
	Alias /js /var/www/httpd/cgi-bin/js(Do not use ScriptAlias,which will treat the file as script)
	<script src="/js/aaa.js"></script>
	
	write log to apache2
	def apache_log(str):
		print >> sys.stderr, str
	
    
    How to remote tailf ?
    (http://unix.stackexchange.com/questions/133951/how-to-terminate-remotely-called-tail-f-when-connection-is-closed)
    ssh -t user@remote_host tail -f /some/file
	
22.	exec of '...' failed(No such file or directory:exec of)
	change /usr/local/bin/python --> /usr/bin/python
	
	vim 文件路径,发现文件存在,但是文件名后面有dos,于是在linux下重新创建了一个文件,并将之前的文件内容粘贴进去，就可以执行了.
	
	Script not found or unable to stat
	check if the script exists on specific path.
	
23.	you must have a tty to run sudo
	visudo /etc/sudoers
	Comment "Defaults requiretty"注释掉
	
24.	no tty present and no askpass program specified(no password needed 设置为不需要密码)
	visudo
	apache ALL = NOPASSWD: /usr/bin/ssh
	root ALL = NOPASSWD: /usr/bin/ssh
	
25.	Finding out what user Apache is running as?(apache username)
	ps aux | egrep '(apache|httpd)'
	
26.	ssh id_rs.pub not working(http://unix.stackexchange.com/questions/36540/why-am-i-still-getting-a-password-prompt-with-ssh-with-public-key-authentication)
	Why am I still getting a password prompt with ssh with public key authentication?
	chmod o-w ~/(or the /root)
	chmod 700 ~/.ssh
	chmod 600 ~/.ssh/authorized_keys
	
	Debug ssh connections
	
	(server machine B)service sshd stop
	/usr/sbin/sshd -d(local machine A, ssh root@server_ip)
	...Debug output...
	service sshd start
	
	
	
27.	change owner and group of a directory(http://www.thegeekstuff.com/2012/06/chown-examples/)
	chown root /home/testUser(change owner to root)
	chown :root /home/testUser(change group to root)
	
28.	What does ls -al mean??(http://unix.stackexchange.com/questions/103114/what-do-the-fields-in-ls-al-output-mean)
	n the order of output;

	-rwxrw-r--    10    root   root 2048    Jan 13 07:11 afile.exe
	file permissions,
	number of links,
	owner name,
	owner group,
	file size,
	time of last modification, and
	file/directory name
	
29.	Xsheel 5,,No matching outgoing encryption algorithm found
	Properties --> SSH --> Security --> Encryption(aes256-ctr) --> MAC(hmac-sha2-256)
	
30.	Forgot ubuntu user password
	https://www.liberiangeek.net/2014/10/change-forgotten-password-ubuntu-14-04-servers/
    
    forget redhat root password
    1. reboot
    2. press the arrow keys to highlight the installation you want to edit, and  type A to enter append mode
    grub append> ro root=LABEL=/
    3. press Home button to add "single" to the end of "LABEL=/"
    grub append> ro root=LABEL=/ single
    4. Press Enter, grub will boot single user mode.
    5. passwd root
	
31.	# Check if running as root
if [ "$(id -u)" != "0" ]; then
        echo "You must run this script as root"
        exit 1
fi

32. bash compare comparing float number
	num1=1.59
	num2=1.6
	result=`echo $num1'>'$num2 | bc -l`
	if [ $result -gt 0 ]; then
		echo 'num2 > num1'
	fi

33. find file name contains(with name)
find . -iname "*string*" -maxdepth 1 -print
How to limit depth for recursive file list??(print all the directories)
find . -maxdepth 1 -type d -print

find file newer than a day 
find . -mtime -1 -print
find . -mtime +3 -print

finding files newer than another file
find . -mindepth 3 -maxdepth 3 -type d -exec sh -c '
  for dir do
    find "$dir" -type f -newer "$dir"/MarkSheet*
  done' sh {} +
  
  find usage:
  http://mywiki.wooledge.org/UsingFind

34. How to set DNS on Ubuntu 14.04?(http://unix.stackexchange.com/questions/128220/how-do-i-set-my-dns-on-ubuntu-14-04)
	ubuntu show the current DNS,show DNS ipv4(nmcli dev show eth0)
	sudo vim /etc/resolvconf/resolv.conf.d/head
	nameserver 8.8.8.8
	nameserver 8.8.4.4 
	sudo resolvconf -u(sudo service network-manager restart)
	
35. perl: warning: Setting locale failed. Ubuntu 14.04
	(ref:http://stackoverflow.com/questions/2499794/how-can-i-fix-a-locale-warning-from-perl)
	Add following line in ~/.bashrc
	export LANGUAGE=en_US.UTF-8
	export LC_ALL=en_US.UTF-8
	export LANG=en_US.UTF-8
	export LC_TYPE=en_US.UTF-8
	source ~/.bashrc
	
	cannot change locale (en_US.UTF-8): No such file or directory
	setlocale: LC_ALL: cannot change locale (en_US.UTF-8)
	locale-gen en_US en_US.UTF-8
	dpkg-reconfigure locales
	echo "export LANG=\"en_US.UTF-8\"" >> ~/.bashrc
	source ~/.bashrc

	Linux 终端中文乱码,python3 输入中文也乱码
	先在 ~/.bashrc 里面加上 export LANG="en_US.UTF-8"
	再 locale-gen en_US en_US.UTF-8
	发现终端和 python3 下中文都正常了..(跟中转服务器没关系,重新登录下就可以了)
	
36. shell list contains(http://stackoverflow.com/questions/8063228/how-do-i-check-if-a-variable-exists-in-a-list-in-bash)
contains() {
    [[ $1 =~ $2 ]] && exit(0) || exit(1)
}

37. How to delete soft link??
	a file : 
	rm link_file_name
	unlink link_file_name
	
	a directory : (delete soft link to directory)
	mkdir bar
	ln -s bar temp
	rm temp
	
38. sudo without password
 sudo visudo
 userName ALL=(ALL) NOPASSWD: ALL
  man sudoers
   NOPASSWD and PASSWD

   By default, sudo requires that a user authenticate him or herself
   before running a command.  This behavior can be modified via the
   NOPASSWD tag.  Like a Runas_Spec, the NOPASSWD tag sets a default for
   the commands that follow it in the Cmnd_Spec_List.  Conversely, the
   PASSWD tag can be used to reverse things.  For example:

    ray  rushmore = NOPASSWD: /bin/kill, /bin/ls, /usr/bin/lprm

   would allow the user ray to run /bin/kill, /bin/ls, and /usr/bin/lprm
   as root on the machine rushmore without authenticating himself.
   
39. set ssh can not login as root
	adduser superuser
	passwd superuser
	echo 'superuser ALL=(ALL) ALL' >> /etc/sudoers
	su -(input the root password to verify can login as root)
	sudo vi /etc/ssh/sshd_config
	PermitRootLogin no
	sudo /etc/init.d/ssh restart
	
40. Change ssh port to a non-standard port(2015 for example)
	open port 2015 in amazon aws control center
	sudo vi /etc/ssh/sshd_config
	port=2015
	sudo /etc/init.d/ssh restart
	ssh -p 2015 user@ip_address
	scp -P 2015 user@ip_address /tmp/
	
	CentOS 6.7
	Port 2015
	service sshd restart
	iptables -I INPUT -p tcp --dport 2124 --syn -j ACCEPT
	service iptables save
	semanage port -a -t ssh_port_t -p tcp 2124
	
41. /var/log/auth.log is empty
	sudo chown syslog /var/log/auth.log
	
42. change aws ssh port to 80 : 
	log onto amazon 
	starting Amazon EC2 instance via Web Management Console with following 'user data':
	控制台,选择EC2,第一排"启动实例""连接"的右边有个"操作" --> "实例设置" --> "查看更改用户数据"
	https://alestic.com/2010/12/ec2-ssh-port-80/

	How to reverse ssh tunneling?(https://www.howtoforge.com/reverse-ssh-tunneling)
	ssh -i /path/to/private_key/id_rsa -f -N -R 19998:localhost:22 remoteuser@1.2.3.4
	
43. check status of last command
res=`echo $?`
if [ $res -eq 0 ]; then
echo "ok"
else
fi

44. Get top used command in my linux
history | awk '{CMD[$2]++;count++;}END { for (a in CMD)print CMD[a] " " CMD[a]/count*100 "% " a;}'
| grep -v "./" | column -c3 -s " " -t | sort -nr | nl |  head -n10
sort -n -k 3,3 temp_blank

memory usage by bytes top 10
ps aux --sort -rss |head -10

get all cores of CPU usage:
1.top
2.Press 1

45. install locate on CentOS
Debian : apt-get install locate
CentOS : yum install mlocate

46. Diagnose network problems using mtr
mtr -rw 123.123.123.123

47. How to export putty sessions ?
regedit /e "%userprofile%\desktop\putty-sessions.reg" HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions

48. How to kill all connections that occupy the specific port number?
For example, kill all connections that occupy port=38035?
  port = 38035
  netstat -np |grep $port
  lsof -np $pid |grep $port
  gdb -p $pid
  close(number)
  quit
	
49. wget rename file
  wget --content-disposition  https://www.abc.com/def/a/file_name.java
  
50. How to extract files to another directory using tar?
	tar extract multiple files
    tar -xf archive.tar -C /target/directory
	ls /all_files/*.tar.gz | xargs -i tar -zxf {} -C /target/directory
	
51. svn, how to rollback commited changes ?
    svn log
	svn diff -r28:25
	svn merge -r28:25
	svn diff -r28:25
	svn commit -m"rollback"
	
	Let current revision be 729:
	svn up -r 728
	svn merge --dry-run -r729:728 .
	svn merge -r729:728 .
	svn ci * -m"rollback changes"
	
	svn, cancel add before commit
	svn revert --recursive folder_name
    
    svn how to export deleted files ?
    Method 1 : svn up -r $revision $fileName && cat $fileName >> temp && rm $fileName
    Method 2 : svn cp file_url_path@revision abc && cat abc >> temp && svn revert --recursive . && rm abc
    Method 3 : svn export file_url_path@revision abc && cat abc >> temp && rm abc
	
52. svn how to rollback delete files?(if not commited, svn revert foo.txt)
    svn rm foo.txt
    svn ci foo.txt -m "removed file"
    (now at r5 as an example)
    svn cp url/to/removed/foo.txt@4 -r4 foo.txt
    svn ci foo.txt -m "got file back"
	
	svn how to rename a directory ?
	svn mv dir1 dir2
	svn ci * -m"rename dir"
	
	svn how to ignore a directory and file ?
	$> ls *
	foo.txt bat.txt 3Party/1.txt 3Party/2.txt 3Party/directoryName/1.txt
	$> echo "foo.txt" > .svnignore
	$> svn propset svn:ignore -F .svnignore .
	$> cd 3Party
	$> echo -e "foo.txt\ndirectoryName" > .svnignore
	$> svn propset svn:ignore -F .svnignore .
	
	svn revert all changes in a repository
	svn revert -R .
	svn status --no-ignore | grep -E '(^\?)|(^\I)' | sed -e 's/^. *//' | sed -e 's/\(.*\)/"\1"/' | xargs rm -rf
	svn update --force
	
53. setup svn server ubuntu(http://odyniec.net/articles/ubuntu-subversion-server/)
    sudo mkdir /usr/local/svn 
	sudo mkdir /usr/local/svn/repos
	sudo groupadd svn
	sudo chgrp svn /usr/local/svn/repos
	sudo chmod g+w /usr/local/svn/repos
	sudo chmod g+s /usr/local/svn/repos(Additionally, you need to make sure that all new files and directories created in the repos directory (in other words, anything committed to the repositories) will also be owned by the group. To accomplish this, use chmod again to set the set-group-ID bit on the directory, which causes any file created inside it to have the same group ownership as the directory itself)
	umask 002
	This command sets the new file mode creation mask which controls the default permissions of any new file that you create. The default value is 022 and it corresponds to read/write permissions for the file owner, and read permissions for the group and others. The new value, 002, also gives write permissions to the group, which is just what you need.
	svnadmin create /usr/local/svn/repos/test
	umask 022
	
	
	sudo vim /usr/local/svn/passwd-team
	[users]
	michal = somepassword
	jimmy = anotherpassword
	craig = yetanotherpassword
	sudo chmod 600 /usr/local/svn/passwd-team
	vim /usr/local/svn/repos/test/conf/svnserve.conf
	There's probably some default configuration in the file, but you can just remove everything and enter this:
	[general]
	anon-access = none
	password-db = /usr/local/svn/passwd-team
	realm = Team
	
	sudo svnserve -d --foreground -r /usr/local/svn/repos
    svn default port is 3690
    Repository has not been enabled to accept revision propchanges;ask the administrator to create a pre-revprop-change hook
    Let svn accept edit logs:
    cd repos/hooks/
    mv pre-revprop-change.tmpl pre-revprop-change
    
    stop svnserve linux:
    ps aux|grep svnserve
    kill -9 $pid
    
    How to switch repository to a totally different URL?
    svn switch --relocate old_path_url new_path_url .
    
    How to specific another port and checkout svn repository?
    svnserve -d --listen-port 3691 -r /usr/local/svn/repos
    svn co svn://ip_address:3691/repository_name
    
    move subversion repository to another server:
    1. svnadmin dump /path/to/repository > repo_name.svn_dump
    2. umask 002 && svnadmin create /path/to/repository && umask 022
    3. svnadmin load /path/to/repository < repo_name.svn_dump

54. set a custom boundary form submit
    http://code.activestate.com/recipes/146306-http-client-to-post-using-multipartform-data/
	
55. What is the differnce between "Request Payload" and "Form Data"?
    http://stackoverflow.com/questions/23118249/whats-the-difference-between-request-payload-vs-form-data-as-seen-in-chrome
	http://stackoverflow.com/questions/10494574/what-is-the-difference-between-form-data-and-request-payload
	
56. How to send a “multipart/form-data” with requests in python?
    http://stackoverflow.com/questions/12385179/how-to-send-a-multipart-form-data-with-requests-in-python
	
57. How to know what errno means?
    #include <errno.h>
	#include <string.h>
	#include <stdlib.h>
	int main(int argc, char **argv)
	{
		printf(strerror(atoi(argv[1]));
	}
	
58. svn edit commit message
    (http://stackoverflow.com/questions/304383/how-do-i-edit-a-log-message-that-i-already-committed-in-subversion)
    svn propedit svn:log --revprop -r NNN
	svn propedit -r N --revprop svn:log URL 
    svn propset -r N --revprop svn:log "new log message" URL 
	
59. Linux source code location
    ls /usr/src/linux
	
60. ctags exclude
    ctags --exclude="*\.svn*" --exclude="*3Party*" -R -h"*cpp*h" -o tags
	
61. How to remove carriage return in Unix?
I'm going to assume you mean carriage returns ("\r", 0x0d) at the ends of lines rather than just blindly within a file.
$ cat infile | od -c
0000000   h   e   l   l   o  \r  \n   g   o   o   d   b   y   e  \n
0000017
$ cat infile | dos2unix -U | od -c
0000000   h   e   l   l   o  \n   g   o   o   d   b   y   e  \n
0000016
$ cat infile | sed 's/\r$//' | od -c
0000000   h   e   l   l   o  \n   g   o   o   d   b   y   e  \n
0000016

cat src/test_client/lua_test.cpp|  head -n 1 | od -c
0000000   #   i   n   c   l   u   d   e       "   l   u   a   _   t   e
0000020   s   t   .   h   "  \r  \n
cat src/test_client/lua_test.cpp | head -n 1 | od -t x
0000000 636e6923 6564756c 756c2220 65745f61
0000020 682e7473 000a0d22

注意是倒序的. 0d0a 是 \r\n, 22代表双引号

62. How to convert files to UTF-8 without BOM?
BOM flag(byte order mark) : 0xefbbbf
BOMflag=`cat filename.txt | od -N 3 -t x`
if [ -z $BOMflag ]; then
  echo "no bom"
else
  echo "this is with bom"
  tail --bytes=+4 filename.txt
fi
    
awk '{if(NR==1)sub(/^\xef\xbb\xbf/,"");print}' filename.txt

63. redirect output to two files
$ date | tee file1 > file2
How to redirect the output of an application in background to /dev/null?
mycommand > /dev/null 2>&1 
in background:
mycommand > /dev/null 2>&1 &
nohup mycommand &

64. how to emulate big endian platform on x86? (emulating a big-endian machine on little-endian hardware)
  big endian systems:
  ARM, MIPS, Sparc 
  
  command line test big endian little endian :
  echo -n I | od -to2 | head -n1 | cut -f2 -d" " | cut -c6 
  big endian : output 0; little endian : output 1
  
  QEMU documentation:
  http://qemu.weilnetz.de/qemu-doc.html
  
  Successfully install big-endian on my windows 7 64-bit machine(成功在windows7 64位上安装Big-endian 开发环境):
  reference : debian Sparc 32 youtube tutorial (https://www.youtube.com/watch?v=Ae5Qrz0j7cg)
  1. download qemu(拼音ki mou) http://lassauge.free.fr/qemu/release/Qemu-2.4.0.1-windows.7z
  2. download qemu image, (for example, sparc_small.qcow2, 140M) https://people.debian.org/~aurel32/qemu/sparc/debian_etch_sparc_small.qcow2
  3. copy the qemu image to the qemu directory
  4. open command prompt at the qemu directory, run :
  qemu-system-sparc.exe -L Bios -m 256M  debian_etch_sparc_small.qcow2 -redir tcp:2222::22
  5. If error occurs, open the error file stderr.txt, for example qemu: could not load prom 'openbios-sparc32', copy Bios/openbios-sparc32 to the exe directory
  6. copy the following commands to a txt file, move the txt windows to the left of the screen; move the qemu windows to the right of the screen, and then log into the system. mind do not move mouse away from the qemu window, or the keyboard will not work and system need to be restarted. We need to update debian source list, install build-essential, install openssh-server(记住将要打的指令一次性都保存在一个记事本里,拖动到小窗口里,然后在qemu里依次打出来.因为鼠标一旦点击了其他窗口,qemu里面键盘好像就失灵了,打不出任何字符,只能重启系统)
  
  cp /etc/apt/sources.list /etc/apt/sources.list.bak
  vi /etc/apt/sources.list
  deb http://archive.debian.org/debian/ etch main non-free contrib
  deb http://archive.debian.org/debian-security/ etch main non-free contrib
  deb http://archive.debian.org/debian-volatile/ etch main non-free contrib
  apt-get update 
  apt-get install build-essential -y
  apt-get install openssh-server -y
  7. After installing ssh server, we do not need the graphic interface again, so we will start the sparc using the following command : 
  qemu-system-sparc.exe -L Bios -m 256M debian_etch_sparc_small.qcow2 -nographic -redir tcp:2222::22
  8. on windows, download ssh or github windows, open cmd, ssh -p 2222 root@localhost (open xshell, ssh root@localhost 2222)
  
  Keyboard: British English (br)
  Language: English
  Mirror: ftp.de.debian.org
  Hostname: debian-sparc
  Root password: root
  User account: user
  User password: user
  
  install debian squeeze on windows 7 64-bit(是big-endian, 但是资源太少,安装build-essential都不方便):
  1. download debian_squeeze_powerpc_standard.qcow2 (https://people.debian.org/~aurel32/qemu/powerpc/)
  2. copy debian_squeeze_powerpc_standard.qcow2 to qemu directory
  3. run 
  qemu-system-ppc.exe -name debianPPC -L Bios -m 512M -boot menu=on,splash=./bootsplash.bmp,splash-time=3000 -rtc base=localtime,clock=host -hda debian_squeeze_powerpc_standard.qcow2   -no-reboot
  useful option : -nographic -redir tcp:2222::22
  qemu-system-ppc.exe -name debianPPC -L Bios -m 512M -boot menu=on,splash=./bootsplash.bmp,splash-time=3000 -rtc base=localtime,clock=host -hda debian_squeeze_powerpc_standard.qcow2 -nographic -redir tcp:2222::22 -no-reboot
  4. watch the stderr.txt on the qemu directory, do operations according to the error infomation.
  5. 不能用国内的源,暂时没搜索到带powerpc的源,直接运行  apt-get update
  
  install debian wheezy under qemu(是 little-endian, 资源挺多的,安装起来方便):
  1.download debian_wheezy_amd64_standard.qcow2 from  https://people.debian.org/~aurel32/qemu/amd64/
  2.copy debian_wheezy_amd64_standard.qcow2 to qemu directory
  3. open command prompt at the qemu directory, run qemu-system-x86_64  debian_wheezy_amd64_standard.qcow2
  4. watch stderr.txt, copy files bios-256k.bin efi-e1000.rom kvmvapic.bin vgabios-stdvga.bin from Bios/ to current directory.
  (http://tyom.blogspot.se/2013/03/debiansparc64-wheezy-under-qemu-how-to.html)
  ssh to qemu guest debian wheezy(communications between guest and host):
  https://en.wikibooks.org/wiki/QEMU/Networking
  qemu-system-x86_64 -m 512 -redir tcp:2222::22 -nographic debian_wheezy_amd64_standard.qcow2
  
  change debian source 源 list to 163 or aliyun ? (http://mirrors.163.com/.help/debian.html)
  cp /etc/apt/sources.list /etc/apt/sources.list.bak 
  vim /etc/apt/sources.list  
  
  system emulation using qemu, https://gmplib.org/~tege/qemu.html
  setup a PPC(Big-endian) VM using QEMU on a x86(Little-endian) host, debug endian issues, http://wiki.scummvm.org/index.php/HOWTO-Debug-Endian-Issues
  
  qemu image types(https://en.wikibooks.org/wiki/QEMU/Images):
  raw : the raw format is a plain binary image of the disc image, and is very portable. On filesystems that support sparse files, images in this format only use the space actually used by the data recorded in them.
  cloop : Compressed Loop format, mainly used for reading Knoppix and similar live CD image formats
  cow :copy-on-write format, supported for historical reasons only and not available to QEMU on Windows
  qcow : the old QEMU copy-on-write format, supported for historical reasons and superseded by qcow2
  qcow2 : QEMU copy-on-write format with a range of special features, including the ability to take multiple snapshots, smaller images on filesystems that don't support sparse files, optional AES encryption, and optional zlib compression
  vmdk : VMware 3 & 4, or 6 image format, for exchanging images with that product
  vdi : VirtualBox 1.1 compatible image format, for exchanging images with VirtualBox.
  
  create a sparc system image :
  http://codetao.blogspot.jp/2013/05/creating-qemu-sparc-system-image.html
  
  Is there ant big endian OS on which latest gcc could be installed ?? by now, (uname -a)Sparc 2.6 x32 can only install gcc 4.4.1(gcc -Og is not available).
  

65. How to debug bash script ?
    Add the following content:
    echo $variable
    sleep 500
    
66. How to run scp(linux processes) as background process?
    1. nohup scp file_to_copy user@server:/path/to/copy/the/file > nohup.out 2>&1
    2. Press CTRL + Z
    3. enter command : "bg" 
    4. tailf nohup.out to see the logs.
    837449
67. How to add a swap file?
sudo su
dd if=/dev/zero of=/swapfile1 bs=1024 count=1048000
chown root:root /swapfile1
chmod 0600 /swapfile1
mkswap /swapfile1
swapon /swapfile1
vi /etc/fstab
/swapfile1 none swap sw 0 0
free -m
swapon -S
cat /proc/meminfo
swapoff /swapfile1
swapon -s

68. How to watch a file size on Linux?
watch -n 5 "du -h club_prod.sql"
watch -n 5 "ls -lh club_prod.sql | awk '{print \$5}'"

69. Use strace to find all opening and closing files:
strace -e trace="open,close" -o /tmp/my_trace -v GatewayServer
strace -p $Gateway_PID

70. lsof to find all opening files by a process:
lsof -np $PID(network hostname)
lsof -p $PID
lsof -i:8080

71. How to generate An error report file?(An error report file with more information is saved as:)
environments, signal handlers, /proc/cpuinfo, /proc/meminfo

72. ssh remote command get fewer environments than running manually?(man bash)
ssh user@IP "export"
export
The SSH command execution shell is a non-interactive shell, whereas your normal shell is either a login shell or an interactive shell. 


73. How to configure samba on ubuntu 14.04?(http://computernetworkingnotes.com/network-administration/how-to-configure-samba-on-rhel-6.html)
sudo apt-get install samba -y
sudo ufw allow 139
sudo ufw allow 445
Anonymous share:
sudo mkdir -p /shares/anonymous
sudo chown nobody:nogroup /shares/anonymous/
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak
sudo vim /etc/samba/smb.conf
[Anonymous]
       comment = Anonymous share access
       path = /shares/anonymous
       browsable = yes
       writable = yes
       guest ok = yes
       read only = no
       force user = nobody
       force group = nogroup
sudo service smbd restart
sudo service nmbd restart

Secure share:
sudo mkdir -p /shares/project1
sudo addgroup smbse
sudo chown root:smbse /shares/project1/
sudo chmod 770 /shares/project1/
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak
sudo vim /etc/samba/smb.conf
# 控制新创建的文件和目录的权限
create mask = 0664
directory mask = 0775
# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = giant_haha.com
[server]
         comment = my server
         path = /shares/project1
         available = yes
         valid users = @smbse
         read only = no
         guest ok = no
         writable = yes
         browsable = yes         
sudo useradd smbseuser -s /usr/sbin/nologin -G smbse(-s /usr/sbin/nologin : Restricting shell access,-G smbse : Added to smbse group)
sudo smbpasswd -a smbseuser(server)
sudo usermod mike -G smbse(add mike to group smbse)
sudo usermod -a -G smbproj1,smbproj2 dave(add dave to smbproj1 and smbproj2 project)
testparm(for trouble shooting problems)
sudo service smbd restart
sudo service nmbd restart

windows clear samba cache:
open cmd, net use * /d
Control panel --> all Control Panel Items --> Credential Manager, delete the cache of specific host.
Task Manager, close explorer.exe, reopen explorer.exe

samba change share direcory:
service smbd stop
service nmbd stop
vim /etc/samba/smb.conf
change the old share name to a new share name, then start samba. 记住,要把旧的名字替换掉,否则可能会出现无法连接的情况.
---
copy linux include header files to Visual studio
cp -r /usr/include .
tar -jcf all_linux.tar.gz include/
add C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\crt\src\linux to include path.

cp -r 会使软链接不可用,应该使用 cp -rs 或者 cp -a
	
==================
YouCompleteMe
==================
Question can be turned off with options, see YCM docs
let g:ycm_confirm_extra_conf = 0

=============
vim tips
=============
vim auto indent tab size
filetype plugin indent on
set tabstop=4
set shiftwidth=4
set expandtab

vim  replace all the tabs with spaces
:%retab

jump to the start and end of a code block?
[{, jump to the start
]}, jump to the end
[(
])
[m
]m

==================
How to configure a ubuntu to accept ssh?
==================
sudo apt-get update
sudo apt-get install openssh-server
sudo ufw allow 22
sudo ufw deny from 1.2.3.4 to any
	
==================
How to install nodejs on ubuntu 14.04??
==================		
sudo apt-get update
sudo apt-get install nodejs
sudo apt-get install npm

install nodejs trash
sudo npm install --save fs-extra
sudo npm install --global trash
--- fs-extra contains methods that aren't included in the vanilla Node.js fs package. Such as mkdir
sudo npm install fs-extra

---
ubuntu 搭建FTP服务器(https://help.ubuntu.com/lts/serverguide/ftp-server.html)
sudo apt-get install vsftpd -y
sudo vim /etc/vsftpd.conf
anonymous_enable=Yes
write_enable=yes
anon_upload_enable=yes
sudo usermod -d /path/to/ftp ftp
sudo service vsftpd restart

---
errors:
vsftpd: refusing to run with writable root inside chroot ()
chmod 755 /src/ftp

553 could not create file
chown -R ftp /path/to/ftp_files
---
Redhat搭建FTP服务器,并在windows资源管理器中下载文件(http://computernetworkingnotes.com/network-administration/how-to-configure-ftp-server-in-rhel6.html)
1.install
rpm -ivh vsftpdXXX.rpm(yum install vsftpd)
rpm -ivh ftpdXXX.rpm(yum install ftp)
service vsftpd start | stop | restart.
2.configure
2.1 check if you have configured the firewall properly
iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT
vim /etc/vsftpd/vsftpd.conf
anonymous_enable=YES
2.2 ftp localhost
When a user connects on the FTP server with anonymous username, actually that user connects on the server as a user named ftp
cat /etc/passwd | grep ftp
If you are running Linux without SELinux that's all setting which we need for this exercise. SELinux is listed in RHCE6 exam objective. So if you have configured SELinux, also configure following boolean option.
chcon -R -t public_content_t /var/ftp/pub/

3.vsftpd log files
man vsftpd.conf
/var/log/vsftpd.log

ll /var/ftp/pub
User Name : ftp
Password : no password..

---
putty Network Error: Software caused connection abort
xshell connection closed by foreign host
Putty -> Connection -> 
Sending of null packets to keep session active
Set Seconds between keepalive 30
30 is 30 seconds
---
---
What you need when you buy a VPS
How to touch file with certain size ? (generate a file with a given size in Linux)
dd if=/dev/zero of=certain_size bs=1M count=100
truncate -s 10G foo
fallocate -l 5G bar
du -B1 --apparent-size /tmp/foo.txt

How to mmap the file into memory?

1. How to make fail2ban bans persistent(fail2ban blacklist)
sudo touch /etc/fail2ban/ip.blacklist
make a copy of /etc/fail2ban/action.d/iptables-multiport.conf
sudo vim /etc/fail2ban/action.d/iptables-multiport.conf
actionban = iptables -I f2b-<name> 1 -s <ip> -j DROP
            echo <ip> >> /etc/fail2ban/ip.blacklist
actionstart = iptables -N f2b-<name>
              iptables -A f2b-<name> -j RETURN
              iptables -I INPUT -p <protocol> -m multiport --dports <port> -j f2b-<name>
              cat /etc/fail2ban/ip.blacklist | while read IP; do iptables -I f2b-<name> 1 -s $IP -j DROP; done
			  
If you want to unban the IP when fail2ban unbans the IP(not recommanded):
actionunban = iptables -D fail2ban-<name> -s <ip> -j DROP
              sed -i /<ip>/d ip.blacklist
			  
2.Centos auth.log location
Red Hat family distributions (including CentOS and Fedora) use /var/log/messages and /var/log/secure 
where Debian-family distributions use /var/log/syslog and /var/log/auth.log
---
---
What is the difference between man and info??
(http://askubuntu.com/questions/9325/what-is-the-difference-between-man-and-info-documentation)
There are actually other documentation systems in use, beside man and info, Gnome and KDE.
---

	
Bash Script error catching
--------------------------
1. test the exit status of a command directly
	if cp -rv /path/from/ /path/to
	then echo "successful"
	fi

---
bash script arithmetic Expressions:
http://www.softpanorama.org/Scripting/Shellorama/arithmetic_expressions.shtml#Arithmetic_operations
推荐算法
content-based recommendation algorithms


---
Difference between df and fdisk?
df -h displayed all of the mounted partitions
fdisk -l displays all of the partitions that exist on your disk.(Apparently there are some partitions which exist, but which are not mounted.)

使用 fdisk 给磁盘分区
fdisk /dev/vdb
p
n
1
+100G
p
root@localhost ~]#mkfs.ext3 /dev/vdb1
[root@localhost ~]#mkfs.ext3 /dev/vdb2
[root@localhost ~]#mkdir /vdb1 /vdb2
[root@localhost ~]#mount /dev/vdb1 /vdb1
[root@localhost ~]#mount /dev/vdb2 /vdb2
[root@localhost ~]#df -h
